# Claw-Empire v1.1.3 Release Notes

- Release date: 2026-02-21
- Scope: Project-centric workflow rollout (Project Manager + directive/task project binding), OpenClaw upgrade enforcement hardening, and light-mode action-button visibility polish.

## Highlights

- **Project-First Chat Flow (Task/Directive)**
  - `ChatPanel` now requires a project branch before sending task instructions:
    - existing project vs new project selection
    - existing project list: latest 10, selectable by number (`1-10`) or project name
    - new project creation: `name + project_path + core_goal`
  - For `$` directives, the directive text is auto-used as the new project's `core_goal`.
  - Confirmation step now shows project metadata + round-goal preview before send.

- **Project Manager in Task Board**
  - Added **Project Manager** button next to `New Task` in the work-management header.
  - Added/expanded project CRUD UX:
    - project search + pagination
    - create/edit/delete project
    - right-side project info panel with mapped task/report history

- **Mapped Task/Report History in Project Manager**
  - Task history is grouped by root task with child subtask counts.
  - Clicking a task-history card opens detailed report modal.
  - Report modal includes:
    - agent avatar + owner metadata
    - planning-lead consolidated summary
    - team tabs, linked subtasks, progress logs
    - paginated source documents for long outputs

- **Server-Side Project Linkage Hardening**
  - Directive/task delegation now persists `project_id` + `project_path` + `project_context` into task lifecycle.
  - Round-goal text generation now includes project core goal context.
  - Cross-department collaboration tasks inherit parent project linkage.
  - Added fallback project resolution in delegation flow:
    - by `project_id`
    - by normalized `project_path` candidates
    - by `project_context` hints (including existing-project latest fallback)

- **OpenClaw AGENTS Upgrade Enforcement (Default ON)**
  - `/api/directives` and `/api/inbox` now enforce project binding for directives by default.
  - Missing required project binding on directives returns:
    - `HTTP 428`
    - `error=agent_upgrade_required`
    - install metadata (installer files, absolute installer paths, target AGENTS path, recommended command, user prompt)
  - Enforcement toggle for temporary debugging:
    - `ENFORCE_DIRECTIVE_PROJECT_BINDING=0`

- **Light-Mode Visibility Fix**
  - Improved contrast of the TaskBoard **Project Manager** action button in light theme.
  - Added dedicated button class and light/dark hover styles to avoid washed-out appearance.

- **Browser Stability & Memory Optimization (Chrome STATUS_ACCESS_VIOLATION fix)**
  - **WebSocket Broadcast Batching** — High-frequency events (`cli_output` 250ms, `subtask_update` 150ms) are now batched with a cooldown window and flushed together, reducing browser-side message flooding. Capped at 60 queued items per batch with try/catch fault isolation in flush loop.
  - **Tab Visibility-Aware Polling** — All `setInterval` polling (App 5s, TerminalPanel 1.5s, AgentStatusPanel 5s, usePolling hook) now pauses when the browser tab is hidden via `visibilitychange` event. Polling resumes immediately with a fresh sync when the tab regains focus.
  - **GPU Memory Leak Fix (Pixi.js)** — Added `destroyNode()` function that calls `.destroy({ children: true })` for one-shot sprites (speech bubbles, completed delivery animations). Reusable sprites (scene-rebuild preserved deliveries) continue to use the original `detachNode()` to avoid breaking in-flight animations.
  - **State Array GC Pressure Reduction** — Replaced double-spread `appendCapped` with `slice` + `push` pattern, eliminating redundant intermediate array allocations on every WebSocket message across 5 state arrays (messages 600, subtasks 2000, subagents 600, deliveries 240, CEO calls 480).
  - **ChatPanel Message Filter Memoization** — Wrapped `visibleMessages` computation in `useMemo` with stable primitive dependencies (`selectedAgentId`, `selectedTaskId`), preventing re-filtering of up to 600 messages on every render cycle.

## Changed Files (Major)

### Frontend
- `src/App.tsx`
- `src/components/ChatPanel.tsx`
- `src/components/OfficeView.tsx`
- `src/components/TerminalPanel.tsx`
- `src/components/AgentStatusPanel.tsx`
- `src/components/ProjectManagerModal.tsx`
- `src/components/TaskBoard.tsx`
- `src/components/TaskReportPopup.tsx`
- `src/hooks/usePolling.ts`
- `src/index.css`
- `src/api.ts`
- `src/types/index.ts`

### Backend
- `server/ws/hub.ts`
- `server/modules/routes/core.ts`
- `server/modules/routes/collab.ts`
- `server/modules/routes/collab/coordination.ts`
- `server/modules/routes/ops.ts`
- `server/modules/routes/ops/messages.ts`
- `server/modules/workflow/orchestration.ts`
- `server/server-main.ts`

### Rules / Docs
- `templates/AGENTS-empire.md`
- `docs/releases/README.md`
- `docs/releases/v1.1.3.md`
- `README.md`
- `README_ko.md`
- `README_jp.md`
- `README_zh.md`

## Operational Notes

- If OpenClaw is still on old rules, directive calls may fail with `HTTP 428` until AGENTS is updated.
- Windows users should use PowerShell installer path:
  - `powershell -ExecutionPolicy Bypass -File .\scripts\openclaw-setup.ps1`
- macOS/Linux users should use shell installer path:
  - `bash scripts/openclaw-setup.sh`

